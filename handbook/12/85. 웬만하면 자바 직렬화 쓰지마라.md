## 웬만하면 자바 직렬화 쓰지마라  

### 직렬화(Serialization)가 뭐지?    

![0_adJu9E9hB0RPdoAW](https://user-images.githubusercontent.com/80666066/161501771-e19db4cc-0117-430c-8bfb-c158c59a1182.png)
> 출처 : https://www.geeksforgeeks.org/serialization-in-java/  

`직렬화`란 객체에 저장된 데이터를 바이트 스트림에 쓰기 위해 연속적인(serial) 데이터로 변환하는 것을 뜻한다  
객체를 `상태 그대로 저장`하고 필요할 때 다시 생성하여 사용하는 것이 목적이다  
`역직렬화(Deserialization)`는 직렬화의 반대말로, 바이트 스트림을 가져와서 객체가 저장되었던 상태로 변환하는 것이다  
직렬화로 생긴 바이트 스트림은 플랫폼에 독립적인데, 직렬화된 객체는 다른 플랫폼에서 역직렬화가 가능하다는 뜻이다  

<br/>

### 직렬화/역직렬화는 너무 위험하다   

**직렬화는 위험**하다  
근본적으로 공격 범위가 너무 넓고, 지속적으로 더 넓어져 방어하기 어렵다  
역직렬화에는 `ObjectInputStream`의 `readObject`메서드가 쓰이는데,  
`Serializable`을 구현한 클래스 패스 안의 거의 모든 타입의 객체를 만들어 낼 수 있고, 모든 코드를 수행할 수 있다  
**코드 전체가 공격 범위에 들어간다**는 뜻이다  
이미 보안 전문가들이 자바 라이브러리와, 널리 쓰이는 서드 파티 라이브러리에서 `가젯(gadget)`이라 불리는,  
`역직렬화 과정에서 악용될 수 있는 메서드`들을 많이 찾아냈다  

<br/>

### 그래도 쓰겠다면... 

#### 1. 새로운 시스템 작성 시 자바 직렬화를 써야 할 이유가 전혀 없다  
객체와 바이트 시퀀스를 변환해주는 좋은 대안들이 있다  
대표적으로 `JSON`과 `프로토콜 버퍼(Protocol Buffer)`이다  
크로스 플랫폼 지원, 우수한 성능, 풍부한 지원 도구, 활발한 커뮤니티와 전문가 집단 등 수많은 이점까지 주어진다  

#### 2. 레거시 시스템 때문에 써야 한다면, 신뢰할 수 없는 데이터는 절대 역직렬화 하지 않는다  

자바 공식 보안 코딩 지침에도 있는 사항이다  
데이터를 완전히 신뢰할 수 없다면, `객체 역직렬화 필터링(ObjectInputFilter)`를 사용하자  
특정 클래스를 받아들이거나 거부할 수 있다  

#### 3. 써야만 한다면 마이그레이션을 고려하라  
자바 직렬화를 쓰는 시스템을 관리해야 한다면, 시간과 노력을 들여서라도 마이그레이션 하는 게 나을 수 있다  

<br/>

### 참고글  
- https://medium.com/@lunay0ung/basics-%EC%A7%81%EB%A0%AC%ED%99%94-serialization-%EB%9E%80-feat-java-2f3eb11e9a8  

